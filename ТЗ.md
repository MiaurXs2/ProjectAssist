# ТЗ для системы помощи сопровождения разработки проекта (ProjectAssist)

## Теория
Проект - это большой объем кода. Работа над проектом организована следующим образом. Задача программиста - внесение изменений в кодовую базу для исправления какой-то ошибки или реализации нового функционала. Так вот, получив задачу программист делает копию проекта (это в git называется ответвится, создать ветку), вносит свои изменения и отправляет на сервер, туда же где лежит и весь код. На сервере он создает MR (Merge Request), т.е. запрос на слияние его ветки, т.е. его изменений кода в общий код.

МР (изменения программиста) должны проверить другие программисты. У нас достаточно, чтобы проверил и одобрил изменения один другой программист.

Для каждого программиста закреплен список разработчиков, которые могут проверять его МР.

МР бывают в следующих состояниях:
 - черновик (разработчик что-то дорабатывает)
 - ожидает назначения ревьювера
 - ожидает аппрув (одобрения)
 - одобрен
 - слит

Вся кодовая база и работа с кодом осуществляется на сервере GitLab

## Требования

Разрабатываемая система (далее "Система") должна осуществлять следующие функции:

### Учет пользователей

#### Регистрация пользователя с учетом роли
При регистрации нового пользователя он указывает свою роль (или роли, у одного человека их может быть несколько) в проекте (разработчик, тестировщик, тимлид, админ), так же указывает свой логин на сервере gitlab. После регистрации учетная запись создается со статусом "не подтверждена" и всем пользователям с ролью "админ" рассылается сообщение с просьбой подтвердить учетную запись и роль пользователя в проекте.

Для пользователя со статусом разработчик позволять назначать список допустимых ревьюверов из списка пользователей с ролью разработчик.

### Ассистент GitLab

С установленной периодичностью (в минутах) делать запрос к серверу GitLab и проверять, не появилось ли на сервере новых, не учтенных в разрабатываемом проекте ProjectAssist, МР. При обнаружении МР добавлять его в БД со статусом "новый" для последующего отслеживания его изменений. Далее при каждом опросе проверять МР-ы (кроме слитых) занесенные в Систему на предмет изменения статуса. Отрабатывать следующие изменения:

##### с любого статуса кроме "слит" в статус "ожидает назначения ревьювера"
 - выбрать случайного ревьювера из списка допустимых 
 - отправить запрос на установку ревьювера на сервер gitlab

##### с любого статуса кроме "слит" в статус "ожидает одобрения"
 - отправить сообщение автору МР с текстом, что на его МР назначен ревьювер 
 - отправить сообщение назначенному ревьювером пользователю о необходимости провести код ревью

##### с любого статуса кроме "слит" в статус "одобрен"
 - отправить сообщение автору МР с текстом, что его МР одобрен
 - отправить сообщение пользователям с ролью "тимлид" о необходимости слить код
